---
# Konfiguracja retencji i harmonogramu
os_janitor_retention_days: 90
os_janitor_schedule: "*-*-* 03:00:00"  # Codziennie o 3:00
os_janitor_log_dir: "/var/log/openstack-janitor"
os_janitor_script_path: "/usr/local/bin/openstack-janitor.sh"

# Grupa Ansible, na której wdrożyć Janitora (zazwyczaj kontrolery OpenStacka)
os_janitor_control_group: "control"

# Parametry dla Novy
os_janitor_max_rows: 1000

# Parametry dla Heat
os_janitor_max_stacks: 10

# Mapowanie komponentów na kontenery i komendy
# 'cmd': Komenda do wykonania wewnątrz kontenera.
# Placeholder __DAYS__ zostanie podmieniony na liczbę dni.
# Placeholder __DATE_LIMIT__ zostanie podmieniony na datę (format YYYY-MM-DD) wyliczoną z retencji.
# Aby odblokować clenaera dla danego komponentu należy ustawić odpowiednią flagę w formacie os_janitor_enable_ + nazwa_kompotnentu ie. os_janitor_enable_nova_api=true
os_janitor_components_map:
  nova_api:
    container: "nova_api"
    cmds:
      - "nova-manage db archive_deleted_rows --max_rows {{ os_janitor_max_rows }} --until-complete --verbose"
      - "nova-manage db purge --before __DATE_LIMIT__ --verbose"
  nova_conductor:
    container: "nova_conductor"
    cmds:
      - "nova-manage db archive_deleted_rows --max_rows {{ os_janitor_max_rows }} --until-complete --verbose"
      - "nova-manage db purge --before __DATE_LIMIT__ --verbose"
  cinder:
    container: "cinder_api"
    cmds:
      - "cinder-manage db purge __DAYS__"
  heat:
    container: "heat_api"
    cmds:
      - "heat-manage purge_deleted -b {{ os_janitor_max_stacks }} __DAYS__"
  glance:
    container: "glance_api"
    cmds:
      - "glance-manage db purge --age_in_days __DAYS__ --max_rows {{ os_janitor_max_rows }}"

# Opcja pozwalająca na uruchomienie skryptu natychmiast po wdrożeniu (np. do testów)
os_janitor_run_now: false
# Jeśli run_now jest true, to jaki komponent uruchomić? 'all' lub nazwa np. 'nova'
os_janitor_run_target: "all"
